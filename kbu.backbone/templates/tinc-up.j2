#!/bin/sh
/sbin/ip addr add {{ kbu_backbone_network[inventory_hostname].ipv4 }} dev $INTERFACE
/sbin/ip link set dev $INTERFACE up

# IPv4
## Default-Route for Mesh-clients
/sbin/ip route add default dev $INTERFACE table freifunk

# IPv6
## VPN-Addresses (local)
/sbin/ip -6 addr add {{ kbu_backbone_network[inventory_hostname].ipv6 }} dev $INTERFACE

{% if inventory_hostname in ff_servers %}
{% set network_ipv6 = ff_servers[inventory_hostname].ipv6 | ipcalc %}
## Public-IP as announced in backbone
/sbin/ip -6 addr add {{ network_ipv6.host_min }}/128 dev $INTERFACE
{% endif %}

## Default-Route for mesh clients
/sbin/ip -6 route add default dev $INTERFACE table freifunk

/etc/init.d/nagios-nrpe-server restart
